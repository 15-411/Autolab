<%# Make sure these options are not on the general user options list.  %>
<%# We have to do this because we exposed the internal interface for building options lists %>
<%# and some users have fiddled with this in their assessment.rb file %>

<%# These options have been eliminated %>
<% @list.delete("listAdmin") %>

<%# These options should only be on the admin list %>
<% @list.delete("edit") %>
<% @list.delete("viewGradesheet") %>
<% @list.delete("attachments") %>
<% @list.delete("extension") %>
<% @list.delete("submission") %>
<% @list.delete("reload") %>

<div class="row">
  <div class="col-md-12"> 
    <h2><%= @assessment.name %></h2>
    <hr>
  </div>
</div>
<div class="row">
  <div class="col-md-4"> 
    <%# Display any optional instructor admin options %>
    <% if @cud.instructor? then %>
      <h3>Admin Options</h3>
      <ul class="options">
        <% if @assessment.has_svn then %>
          <li><%= link_to "SVN Settings", [:adminSVN, @course, @assessment], title: "Manage the SVN repositories" %></li>
        <% end %>

        <% @adminlist.each_pair do |key, value| %>
            <li> <%= link_to value, {:action => key}, {:title=>(@admin_title[key] || "")} %></li>
        <% end %>
      </ul>
    <% end %>
    <%# Display the optional CA admin options %>
    <% if @cud.course_assistant? then %>
        <h3>Admin Options (CA)</h3>
        <ul class="options">
        <% for option in @options do %>
          <li><%= link_to option['name'], option['url'], :title=>option[:title] %></li>
        <% end %>
        </ul>
    <% end %>
    <h3>Options</h3>
    <ul class="options">
    <% @list.sort { |a,b| a[1] <=> b[1] }.each { |key, value| %>
      <% if value.size > 0  then  %>
        <li> <%= link_to value, {:action => key}, {:title=>(@list_title[key] || "")} %> </li>
      <% end %>
    <% } %>
    </ul>
  </div>
  <div class="col-md-8">
    <p><i><%= @assessment.description %></i></p>
    <br>
    <div class="handin-panel">
    <p><b>Due at: </b><span class="moment-date-time"> <%= due_at_display @aud.due_at %></span></p>
    <p><b>Last day to handin: </b><span class="moment-date-time"> <%= end_at_display(@aud.end_at false) %></span></p>

    <% if @cud.instructor? and @assessment.exam? %>
    <p class="attention">This is an exam. While it is in progress, please check Admin > Edit Course > Exam In Progress.</p>
    <% end %>

    <%= render partial: "handin_form", locals: {modal: false, id: "handin_show_assessment"} %>
    </div>
<% download_access = (@cud.instructor?) %>

<% if @extension then %>
  <i>
  You have a <%=@extension.days %> day extension on this assessment
  </i>
  <font size=-1>
  (Due date: <%= due_at_display(@assessment.aud_for(@effectiveCud.id).due_at) %>)
  </font>
  <% end %>
  <% if @assessment.max_submissions != -1 then %>
    <% numSubmissions = @submissions.size %>
    <% if numSubmissions > @assessment.max_submissions then %>
      <% numSubmissions = 0 %>
    <% else %>
      <% numSubmissions = @assessment.max_submissions - numSubmissions %>
    <% end %>
    <i>You have <%= numSubmissions %> <%= (numSubmissions == 1) ? "submission" : "submissions" %> left.</i> 
  <% end %>

  <%# Display any attachments %>
  <% if @assessment.attachments.length > 0 %>
    <h2><%= @assessment.display_name %> Files</h2>
    <ul>
      <%= render @assessment.attachments %>

      <% # this code is temporarily "commented out" because Dan wants to preserve the logic for future changes to _attachment.html.erb %>
      <% if false then %>
        <% for a in @assessment.attachments do %>
          <% if a.released? then %>
            <% if (Time.now() > @assessment.start_at) or (@cud.instructor?) then %>
              <li><%= link_to a.name, [@course, @assessment, a] %></li>
            <% else %>
              <li><%= a.name %></li>
            <% end %>
          <% elsif @cud.instructor? then %>
            <li><i><%= link_to a.name, [@course, @assessment, a] %>*</i></li>
          <% end %>
        <% end %>
      <% end %>
    </ul>
  <% end %>

  <% if @assessment.exam? %>
      <% if download_access %>
          <p>Students will not be able to view previous exam submissions.</p>
      <% else %>
          <p>You cannot view previous exam submissions.</p>
      <% end %>
  <% elsif @assessment.course.exam_in_progress? %>
      <% if download_access %>
          <p>Students will not be able to view previous submissions while an exam is in progress.</p>
      <% else %>
          <p>You cannot view previous submissions while an exam is in progress.</p>
      <% end %>
  <% end %>

    <% if @submissions.size == 0 then %>
      No Submissions yet!
    <% else %>
      <% for submission in @submissions.first(limit=3) do %>
        <%= render partial: "submission_summary_row", 
          locals: { submission: submission, 
          download_access: download_access } %>
      <% end %>
      <hr>
      <%= link_to "See all submissions", {:action => "history"} %></li>

    <% end %>
  </div>

<% content_for :javascript do %>
  <%= javascript_include_tag "assessments_show" %>
<% end %>
