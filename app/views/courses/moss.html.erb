<% @title = "Moss Cheat Checker" %>

<% content_for :javascripts do %>
  <script type="text/javascript">
    /**
     * toggles the "style.display" of the element with the given id.
     **/
    function toggleOptions(id) {
      var show = document.getElementById(id);
      show.style.display = (show.style.display == "none")? "block" : "none";
    }

    function filterCourses(name) {
      $(".filterableCourse").each( function() {
        var course = this;
        var keywords = name.split(" ");
        var toShow = true;
        for (var i=0; i<keywords.length; i++) {
          if (course.id.toLowerCase().indexOf(keywords[i]) == -1)
            toShow = false;
        }
        $(this).toggle(toShow);
      });
    }
	  $(document).ready(function() {
  	  $('select').material_select();
	  });
            
  </script>
<% end %>

<h2>Run the Moss Cheat Checker</h2>
<br>

<h2><b>Step 1:</b> Click on course names to see their assessments, then check box all of the assessments you want Moss to compare against.</h2>
<h3 style="display:inline">Filter Courses (Keywords Separated by Space): </h3><input type="text" onkeyup="filterCourses(this.value.toLowerCase())" style="margin-bottom: 10px;">
<%= form_tag([:runMoss, @course], multipart: true) do %>
  <ul class="moss-list">
  <% for course in @courses %>
    <li class="filterableCourse" id="<%= course.display_name %>">
      <h3 onclick="toggleOptions('<%= course.id %>Assessments')"> 
        <%= course.full_name %>
      </h3>
      <ul id="<%= course.id %>Assessments" class="moss-inner-list" style="display:none" >
      <% for a in course.assessments do %>
        <li>
          <%= check_box_tag "assessments[#{a.id}]","1",false, :class => "filled-in" %> 
          <label for="assessments_<%= a.id %>"> <%= a.display_name %> </label>
          <br>
          <div id='<%= a.id %>OptionsDiv' style="padding-left:10px;" >
            <b>Is Archive:</b>
            <%= check_box_tag "isArchive[#{a.id}]" %>
            <i>Check this if the submissions will need to be extracted. (The handin filename was: <%= a.handin_filename %>)</i>
            <br>
            <b>Files to send to Moss:</b>
						<%= text_field_tag "files[#{a.id}]", "*", :style => "margin-bottom: 10px;" %>
            <i>This can be file names (foo.c) or patterns(*.c)</i>
            <br>
          </div>
        </li>
      <% end %>
      </ul>
    </span>
  <% end %>
  </ul>

  <br>



  <h2><b>Step 2:</b> (Optional) Add flags that will be run with moss.</h2>
  <ul class="moss-list">
    <li class="filterableCourse" id="Moss Flags">
      <h3 onclick="toggleOptions('flags')"> 
	  	Moss Flags
	  </h3>
      <ul id="flags" class="moss-inner-list" style="display:none" >
        <li>
					<%= check_box_tag "box_language","1",false, :class => "filled-in" %> 
					<label for="box_language"> Language </label>
					<br>
					<div id='<%= a.id %>OptionsDiv' style="padding-left:10px;" >
						<div class="input-field">
							<%= select_tag :language_selection, options_for_select([
								["C", "c"], 
								["C++", "cc"],
								["Java", "java"],
								["C#", "csharp"],
								["Python", "pyhton"],
								["Visual Basic", "vb"],
								["Javascript", "javascript"],
								["FORTRAN", "fortran"],
								["ML", "ml"],
								["Haskell", "haskell"],
								["Lisp", "lisp"],
								["Scheme", "scheme"],
								["Pascal", "pascal"],
								["Modula2", "modula2"],
								["Ada", "ada"],
								["Perl", "perl"],
								["Matlab", "matlab"],
								["VHDL", "vhdl"],
								["Verilog", "verilog"],
								["Spice", "spice"],
								["MIPS Assembly", "mips"],
								["a8086 Assembly", "a8086"],
								["ASCII", "ascii"]
							]) %>
							<label>Language Options</label>
						</div>
					</div>
				</li>
				<li>
					<%= check_box_tag "box_max","1",false, :class => "filled-in" %> 
					<label for="box_max">Max Lines </label>
					<br>
					<div id='<%= a.id %>OptionsDiv' style="padding-left:10px;" >
						<%= text_field_tag "moss_max", "", :style => "margin-bottom: 10px;", placeholder: "If you don't know what this is please read the Moss documentation before altering this value." %>
					</div>
				</li>
				<li>
					<%= check_box_tag "box_basefile", "1",false, :class => "filled-in" %> 
					<label for="box_basefile">Base File Tar</label>
					<br>
					<div id='<%= a.id %>OptionsDiv' style="padding-left:10px;" >
						<div class="file-field input-field">
						  <div class="btn">
					      <span>Base File</span>
						    <%= file_field_tag 'base_tar' %>
					    </div>
					    <div class="file-path-wrapper">
					      <input class="file-path validate" type="text" placeholder="Additional files archive">
					    </div>
					  </div> 
						<i>This can be a tar file of any given code that will not be run against moss.</i>
					</div>
				</li>
			</ul>
    </span>
  </ul>
  
  <h3> This field can be used to add a bit more granularity to running moss. If any of the flags listed above are not quiet 
	  what you're looking for, feel free to enter the command line arguments here and they will be passed along. </h3>
  <%= text_field_tag :moss_flags %>

  <br>

  <h2><b>Step 3:</b> (Optional) Upload an archive containing additional files you'd like Moss to compare against.</h2>
  <h3>(Note: the archive must contain only regular files.  Nested archives wil not be extracted.)</h3>
   
  <div class="file-field input-field">
    <div class="btn">
      <span>Archive</span>
      <%= file_field_tag 'external_tar' %>
    </div>
    <div class="file-path-wrapper">
      <input class="file-path validate" type="text" placeholder="Additional files archive">
    </div>
  </div> 
  <br>

  <h2><b>Step 4:</b> Click "Go!" once to run Moss. This may take up to a minute, so be patient...</h2>

  <p><%= submit_tag "Go!", data: { disable_with: "Please wait..." }, class: "btn primary" %></p>
<% end %>
